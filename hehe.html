<!DOCTYPE html>
<html>
<body>

<input type="number" id="windowCount" placeholder="Number of windows" value="5" min="1" max="20">
<button onclick="openWindows()">Open Windows</button>

<script>
  let windows = []; // Store window references
  let imageUrl = "https://github.com/dinodigger33/best-merp/blob/main/frankfurt.jpg?raw=true"; // Change to your image URL
  let windowSize = 150; // Window size (ensuring consistent size)
  let bounceSound = new Audio("https://github.com/dinodigger33/best-merp/raw/refs/heads/main/hamburger-sound-effect.mp3"); // Sound effect URL

  function openBouncingWindow(index, x = 100, y = 100, dx = 5, dy = -10) {
    let myWindow = window.open("", `_blank`, `width=${windowSize + 20},height=${windowSize + 40},left=${x},top=${y},resizable=no`);

    if (myWindow) {
      windows.push(myWindow); // Store reference

      myWindow.document.write(`
        <html>
          <head>
            <title>Bouncing Window ${index + 1}</title>
            <script>
              let x = ${x};
              let y = ${y};
              let dx = ${dx};
              let dy = ${dy};
              let gravity = 0.5;
              let bounceFactor = 1.1
              let isDragging = false;
              let lastX = 0, lastY = 0;
              let screenW = window.screen.availWidth;
              let screenH = window.screen.availHeight;
              let winSize = ${windowSize};
              let bounceSound = new Audio("https://github.com/dinodigger33/best-merp/raw/refs/heads/main/hamburger-sound-effect.mp3");
              
              function adjustWindowSize() {
                window.resizeTo(winSize, winSize);
              }

              function moveWindow() {
                if (!isDragging) {
                  dy += gravity; // Apply gravity
                  x += dx;
                  y += dy;

                  // Bounce off walls
                  if (x + winSize >= screenW || x <= 0) {
                    dx *= -1;
                    playBounceSound();
                  }

                  // Bounce off floor with variable bounce height
                  if (y + winSize >= screenH) {
                    y = screenH - winSize;
                    dy = -Math.abs(dy * bounceFactor);
                    playBounceSound();
                  }

                  // Bounce off ceiling
                  if (y <= 0) {
                    y = 0;
                    dy *= -1;
                    playBounceSound();
                  }

                  window.moveTo(x, y);
                }
              }

              function playBounceSound() {
                bounceSound.currentTime = 0;
                bounceSound.play();
              }

              setInterval(moveWindow, 30);
              setTimeout(adjustWindowSize, 100);

              // Dragging behavior
              window.addEventListener("mousedown", (e) => {
                isDragging = true;
                lastX = e.screenX;
                lastY = e.screenY;
              });

              window.addEventListener("mousemove", (e) => {
                if (isDragging) {
                  let deltaX = e.screenX - lastX;
                  let deltaY = e.screenY - lastY;
                  x += deltaX;
                  y += deltaY;
                  window.moveTo(x, y);
                  lastX = e.screenX;
                  lastY = e.screenY;
                  dx = deltaX * 0.5; // Set velocity for fling
                  dy = deltaY * 0.5;
                }
              });

              window.addEventListener("mouseup", () => {
                isDragging = false;
              });

              window.addEventListener("blur", () => {
                isDragging = false;
              });
            <\/script>
          </head>
          <body style="margin:0; display:flex; justify-content:center; align-items:center; background:black;">
            <img src="${imageUrl}" style="width:100px; height:100px;">
          </body>
        </html>
      `);
      myWindow.document.close();
    } else {
      alert("Pop-ups are blocked! Allow pop-ups and try again.");
    }
  }

  function openWindows() {
    let totalWindows = parseInt(document.getElementById("windowCount").value) || 5;
    windows.forEach(win => win.close()); // Close existing windows
    windows = [];
    
    for (let i = 0; i < totalWindows; i++) {
      let startX = Math.random() * (window.screen.availWidth - windowSize);
      let startY = Math.random() * (window.screen.availHeight / 2);
      let velocityX = (Math.random() > 0.5 ? 1 : -1) * (3 + Math.random() * 3);
      let velocityY = -(5 + Math.random() * 5); // Start with upward motion

      openBouncingWindow(i, startX, startY, velocityX, velocityY);
    }
  }
</script>

</body>
</html>
